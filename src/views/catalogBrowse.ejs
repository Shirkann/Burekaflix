<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= pageTitle || 'Catalog - BurekaFlix' %></title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script type="module" src="/js/catalog.js"></script>

    <link rel="stylesheet" href="/css/main.css" />
  </head>

  <body data-initial-genre="<%= initialGenre || '' %>">
    <%
      function formatContentRating(item) {
        if (item && typeof item.imdb_rating === "number") {
          return item.imdb_rating.toFixed(1);
        }
        if (item && typeof item.rating === "number") {
          return item.rating.toFixed(1);
        }
        return null;
      }
    %>
    <%- include('header', { activePage: 'catalog' }) %>

    <section class="hero">
      <h2 class="movies-title">כחול-לבן, טעים ומצחיק</h2>
      <p>אתר לסרטי בורקס בעיצוב מודרני שמזכיר נטפליקס.</p>

      <form class="search-form">
        <select id="genreFilter">
          <option value="">כל הז׳אנרים</option>
        </select>
        <input id="q" name="q" placeholder="חפש/י תוכן..." />
        <button type="submit" class="btn btn-primary">חיפוש</button>
        <button type="button" id="resetSearch" class="btn btn-outline-secondary">
          נקה
        </button>
      </form>
    </section>

    <div class="container">
      <section class="row">
        <h3 class="movies-title">כל התכנים</h3>
        <div class="scroller" id="catalog-grid"><p>טוען...</p></div>
      </section>

      <section class="row" id="recRow">
        <h3 class="movies-title">מומלץ עבורך</h3>
        <div class="scroller" id="rec-grid">
          <% if (Array.isArray(recommendations) && recommendations.length) { %>
            <% recommendations.forEach(function (item) { const rating = formatContentRating(item); %>
              <a class="card" data-id="<%= item._id %>" href="/content/<%= item._id %>">
                <% if (item && item.posterUrl) { %>
                  <img src="<%= item.posterUrl %>" alt="<%= item.title %>" />
                <% } %>
                <div class="info">
                  <h5><%= item.title %></h5>
                  <p><%= item.summary || "No description available." %></p>
                  <% if (rating) { %>
                    <p class="text-muted mb-0">דירוג IMDb: <%= rating %>/10</p>
                  <% } %>
                </div>
              </a>
            <% }); %>
          <% } else { %>
            <p>צפו בתכנים וסמנו לייק, ונדע מה להציע לכם</p>
          <% } %>
        </div>
      </section>

      <section class="row" id="popularMoviesRow">
        <h3 class="movies-title">הסרטים הפופולריים</h3>
        <div class="scroller" id="popular-movies-grid"><p>טוען...</p></div>
      </section>

      <section class="row" id="popularSeriesRow">
        <h3 class="movies-title">הסדרות הפופולריות</h3>
        <div class="scroller" id="popular-series-grid"><p>טוען...</p></div>
      </section>

      <section class="row" id="newestByGenreRow">
        <h3>החדשים ביותר בכל ז׳אנר</h3>
        <div id="newestByGenreContainer"></div>
      </section>
    </div>

  </body>
</html>
